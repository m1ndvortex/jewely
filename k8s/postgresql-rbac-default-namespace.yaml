# ============================================================================
# RBAC: Allow PostgreSQL pods to access Kubernetes API endpoints
# ============================================================================
# Patroni needs to access the "kubernetes" endpoint in the default namespace
# to discover Kubernetes API servers for DCS (Distributed Configuration Store)
# ============================================================================

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: postgres-pod-default-access
  namespace: default
  labels:
    app: jewelry-shop
    component: database
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: postgres-pod
subjects:
  - kind: ServiceAccount
    name: postgres-pod
    namespace: jewelry-shop

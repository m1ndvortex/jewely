# Nginx Metrics Configuration for Prometheus
# Exposes stub_status module for nginx-prometheus-exporter

# Nginx status endpoint for Prometheus metrics
# This endpoint is scraped by nginx-prometheus-exporter
# Metrics include:
# - Active connections
# - Accepts, handled, and requests counters
# - Reading, writing, and waiting states
location /nginx_status {
    stub_status on;
    access_log off;  # Don't log metrics scraping
    
    # Restrict access to internal networks only
    allow 127.0.0.1;           # Localhost
    allow 172.16.0.0/12;       # Docker networks
    allow 10.0.0.0/8;          # Private network
    allow 192.168.0.0/16;      # Private network
    deny all;                   # Deny all other access
}

# Health check endpoint (proxied to Django)
# Used by load balancers and monitoring systems
location /health/ {
    access_log off;  # Don't log health checks
    include /etc/nginx/snippets/proxy-params.conf;
    proxy_pass http://django_backend;
}

{% extends "base.html" %}
{% load static %}

{% block title %}Integration Settings - Settings{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Integration Settings</h1>
            <p class="mt-2 text-gray-600 dark:text-gray-400">
                Configure payment gateways, SMS providers, and email services
            </p>
        </div>

        <!-- Settings Navigation -->
        <div class="bg-white dark:bg-gray-800 shadow rounded-lg mb-8">
            <div class="border-b border-gray-200 dark:border-gray-700">
                <nav class="-mb-px flex space-x-8 px-6" aria-label="Settings">
                    <a href="{% url 'core:settings_overview' %}" 
                       class="{% if active_tab == 'overview' %}border-blue-500 text-blue-600 dark:text-blue-400{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Overview
                    </a>
                    <a href="{% url 'core:settings_shop_profile' %}" 
                       class="{% if active_tab == 'shop_profile' %}border-blue-500 text-blue-600 dark:text-blue-400{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Shop Profile
                    </a>
                    <a href="{% url 'core:settings_branding' %}" 
                       class="{% if active_tab == 'branding' %}border-blue-500 text-blue-600 dark:text-blue-400{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Branding
                    </a>
                    <a href="{% url 'core:settings_business_hours' %}" 
                       class="{% if active_tab == 'business_hours' %}border-blue-500 text-blue-600 dark:text-blue-400{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Business Hours
                    </a>
                    <a href="{% url 'core:settings_holiday_calendar' %}" 
                       class="{% if active_tab == 'holiday_calendar' %}border-blue-500 text-blue-600 dark:text-blue-400{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Holiday Calendar
                    </a>
                    <a href="{% url 'core:settings_invoice_customization' %}" 
                       class="{% if active_tab == 'invoice_customization' %}border-blue-500 text-blue-600 dark:text-blue-400{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Invoice Settings
                    </a>
                    <a href="{% url 'core:settings_integration' %}" 
                       class="{% if active_tab == 'integration' %}border-blue-500 text-blue-600 dark:text-blue-400{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300{% endif %} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Integrations
                    </a>
                </nav>
            </div>
        </div>

        <!-- Integration Settings Form -->
        <form method="post" class="space-y-8">
            {% csrf_token %}
            
            <!-- Payment Gateway Settings -->
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Payment Gateway</h3>
                
                <div class="space-y-6">
                    <div class="flex items-center">
                        {{ form.payment_gateway_enabled }}
                        <label for="{{ form.payment_gateway_enabled.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                            Enable payment gateway integration
                        </label>
                    </div>
                    {% if form.payment_gateway_enabled.errors %}
                        <div class="text-red-600 text-sm">{{ form.payment_gateway_enabled.errors }}</div>
                    {% endif %}

                    <div id="payment_settings" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.payment_gateway_provider.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    Provider
                                </label>
                                {{ form.payment_gateway_provider }}
                                {% if form.payment_gateway_provider.errors %}
                                    <div class="text-red-600 text-sm">{{ form.payment_gateway_provider.errors }}</div>
                                {% endif %}
                            </div>

                            <div class="flex items-center">
                                {{ form.payment_gateway_test_mode }}
                                <label for="{{ form.payment_gateway_test_mode.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                                    Test mode (sandbox)
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.payment_gateway_api_key_input.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Key
                                </label>
                                {{ form.payment_gateway_api_key_input }}
                                {% if form.payment_gateway_api_key_input.help_text %}
                                    <p class="text-xs text-gray-500 mt-1">{{ form.payment_gateway_api_key_input.help_text }}</p>
                                {% endif %}
                                {% if form.payment_gateway_api_key_input.errors %}
                                    <div class="text-red-600 text-sm">{{ form.payment_gateway_api_key_input.errors }}</div>
                                {% endif %}
                            </div>

                            <div>
                                <label for="{{ form.payment_gateway_secret_key_input.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    Secret Key
                                </label>
                                {{ form.payment_gateway_secret_key_input }}
                                {% if form.payment_gateway_secret_key_input.help_text %}
                                    <p class="text-xs text-gray-500 mt-1">{{ form.payment_gateway_secret_key_input.help_text }}</p>
                                {% endif %}
                                {% if form.payment_gateway_secret_key_input.errors %}
                                    <div class="text-red-600 text-sm">{{ form.payment_gateway_secret_key_input.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SMS Provider Settings -->
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">SMS Provider</h3>
                
                <div class="space-y-6">
                    <div class="flex items-center">
                        {{ form.sms_provider_enabled }}
                        <label for="{{ form.sms_provider_enabled.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                            Enable SMS notifications
                        </label>
                    </div>
                    {% if form.sms_provider_enabled.errors %}
                        <div class="text-red-600 text-sm">{{ form.sms_provider_enabled.errors }}</div>
                    {% endif %}

                    <div id="sms_settings" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.sms_provider.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    Provider
                                </label>
                                {{ form.sms_provider }}
                                {% if form.sms_provider.errors %}
                                    <div class="text-red-600 text-sm">{{ form.sms_provider.errors }}</div>
                                {% endif %}
                            </div>

                            <div>
                                <label for="{{ form.sms_sender_id.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    Sender ID / Phone Number
                                </label>
                                {{ form.sms_sender_id }}
                                {% if form.sms_sender_id.errors %}
                                    <div class="text-red-600 text-sm">{{ form.sms_sender_id.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.sms_api_key_input.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Key / Account SID
                                </label>
                                {{ form.sms_api_key_input }}
                                {% if form.sms_api_key_input.help_text %}
                                    <p class="text-xs text-gray-500 mt-1">{{ form.sms_api_key_input.help_text }}</p>
                                {% endif %}
                                {% if form.sms_api_key_input.errors %}
                                    <div class="text-red-600 text-sm">{{ form.sms_api_key_input.errors }}</div>
                                {% endif %}
                            </div>

                            <div>
                                <label for="{{ form.sms_api_secret_input.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Secret / Auth Token
                                </label>
                                {{ form.sms_api_secret_input }}
                                {% if form.sms_api_secret_input.help_text %}
                                    <p class="text-xs text-gray-500 mt-1">{{ form.sms_api_secret_input.help_text }}</p>
                                {% endif %}
                                {% if form.sms_api_secret_input.errors %}
                                    <div class="text-red-600 text-sm">{{ form.sms_api_secret_input.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Email Provider Settings -->
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Email Provider</h3>
                
                <div class="space-y-6">
                    <div class="flex items-center">
                        {{ form.email_provider_enabled }}
                        <label for="{{ form.email_provider_enabled.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                            Enable custom email provider (uses Django default if disabled)
                        </label>
                    </div>
                    {% if form.email_provider_enabled.errors %}
                        <div class="text-red-600 text-sm">{{ form.email_provider_enabled.errors }}</div>
                    {% endif %}

                    <div id="email_settings" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.email_provider.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    Provider
                                </label>
                                {{ form.email_provider }}
                                {% if form.email_provider.errors %}
                                    <div class="text-red-600 text-sm">{{ form.email_provider.errors }}</div>
                                {% endif %}
                            </div>

                            <div>
                                <label for="{{ form.email_from_address.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    From Email Address
                                </label>
                                {{ form.email_from_address }}
                                {% if form.email_from_address.errors %}
                                    <div class="text-red-600 text-sm">{{ form.email_from_address.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.email_from_name.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    From Name
                                </label>
                                {{ form.email_from_name }}
                                {% if form.email_from_name.errors %}
                                    <div class="text-red-600 text-sm">{{ form.email_from_name.errors }}</div>
                                {% endif %}
                            </div>

                            <div id="email_api_key_div">
                                <label for="{{ form.email_api_key_input.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                    API Key
                                </label>
                                {{ form.email_api_key_input }}
                                {% if form.email_api_key_input.help_text %}
                                    <p class="text-xs text-gray-500 mt-1">{{ form.email_api_key_input.help_text }}</p>
                                {% endif %}
                                {% if form.email_api_key_input.errors %}
                                    <div class="text-red-600 text-sm">{{ form.email_api_key_input.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- SMTP Settings (shown only when SMTP is selected) -->
                        <div id="smtp_settings" style="display: none;" class="space-y-6">
                            <h4 class="text-md font-medium text-gray-900 dark:text-white">SMTP Configuration</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="{{ form.smtp_host.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        SMTP Host
                                    </label>
                                    {{ form.smtp_host }}
                                    {% if form.smtp_host.errors %}
                                        <div class="text-red-600 text-sm">{{ form.smtp_host.errors }}</div>
                                    {% endif %}
                                </div>

                                <div>
                                    <label for="{{ form.smtp_port.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        SMTP Port
                                    </label>
                                    {{ form.smtp_port }}
                                    {% if form.smtp_port.errors %}
                                        <div class="text-red-600 text-sm">{{ form.smtp_port.errors }}</div>
                                    {% endif %}
                                </div>

                                <div>
                                    <label for="{{ form.smtp_username.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        SMTP Username
                                    </label>
                                    {{ form.smtp_username }}
                                    {% if form.smtp_username.errors %}
                                        <div class="text-red-600 text-sm">{{ form.smtp_username.errors }}</div>
                                    {% endif %}
                                </div>

                                <div>
                                    <label for="{{ form.smtp_password_input.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                        SMTP Password
                                    </label>
                                    {{ form.smtp_password_input }}
                                    {% if form.smtp_password_input.help_text %}
                                        <p class="text-xs text-gray-500 mt-1">{{ form.smtp_password_input.help_text }}</p>
                                    {% endif %}
                                    {% if form.smtp_password_input.errors %}
                                        <div class="text-red-600 text-sm">{{ form.smtp_password_input.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="flex items-center">
                                {{ form.smtp_use_tls }}
                                <label for="{{ form.smtp_use_tls.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                                    Use TLS encryption
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gold Rate API Settings -->
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Gold Rate API</h3>
                
                <div class="space-y-6">
                    <div class="flex items-center">
                        {{ form.gold_rate_api_enabled }}
                        <label for="{{ form.gold_rate_api_enabled.id_for_label }}" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                            Enable automatic gold rate updates
                        </label>
                    </div>
                    {% if form.gold_rate_api_enabled.errors %}
                        <div class="text-red-600 text-sm">{{ form.gold_rate_api_enabled.errors }}</div>
                    {% endif %}

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.gold_rate_api_provider.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Provider
                            </label>
                            {{ form.gold_rate_api_provider }}
                            {% if form.gold_rate_api_provider.errors %}
                                <div class="text-red-600 text-sm">{{ form.gold_rate_api_provider.errors }}</div>
                            {% endif %}
                        </div>

                        <div>
                            <label for="{{ form.gold_rate_update_frequency.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Update Frequency (minutes)
                            </label>
                            {{ form.gold_rate_update_frequency }}
                            {% if form.gold_rate_update_frequency.errors %}
                                <div class="text-red-600 text-sm">{{ form.gold_rate_update_frequency.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Webhook Settings -->
            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Webhook Configuration</h3>
                
                <div class="space-y-6">
                    <div>
                        <label for="{{ form.webhook_url.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Webhook URL
                        </label>
                        {{ form.webhook_url }}
                        {% if form.webhook_url.errors %}
                            <div class="text-red-600 text-sm">{{ form.webhook_url.errors }}</div>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">URL to receive webhook notifications for events</p>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex justify-end">
                <button type="submit" 
                        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Save Integration Settings
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function toggleEmailProvider() {
    const provider = document.getElementById('email_provider').value;
    const smtpSettings = document.getElementById('smtp_settings');
    const apiKeyDiv = document.getElementById('email_api_key_div');
    
    if (provider === 'smtp') {
        smtpSettings.style.display = 'block';
        apiKeyDiv.style.display = 'none';
    } else {
        smtpSettings.style.display = 'none';
        apiKeyDiv.style.display = 'block';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleEmailProvider();
});
</script>
{% endblock %}